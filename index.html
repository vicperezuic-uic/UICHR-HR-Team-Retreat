<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>UIC Song Quiz</title>
  <style>
    body {font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5;}
    .container {max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 12px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.1);}
    .question {margin-bottom: 20px;}
    input[type="text"] {width: 100%; padding: 8px; margin-top: 5px; border-radius: 6px; border: 1px solid #ccc;}
    label {display: block; margin: 5px 0;}
    button {background: #cc0000; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;}
    button:hover {background: #990000;}
  </style>
</head>
<body>
  <div class="container" id="quizContainer">
    <h2>UIC Song Quiz</h2>
    <form id="quizForm"></form>
    <button id="submitQuiz">Submit Quiz</button>
    <div id="result"></div>
  </div>

  <script src="questions.js"></script>
  <script>
    const userEmail = localStorage.getItem("userEmail");
    if (!userEmail) window.location.href = "start.html";

    const submissions = JSON.parse(localStorage.getItem("submissions") || "{}");
    if (submissions[userEmail]) {
      document.body.innerHTML = `<div style="text-align:center;margin-top:100px;">
        <h2>You have already submitted the quiz.</h2>
        <p>If this is an error, please contact the administrator.</p>
      </div>`;
    } else {
      const form = document.getElementById("quizForm");

      // Render questions
      questions.forEach((q, i) => {
        const div = document.createElement("div");
        div.className = "question";
        div.innerHTML = `
          <p><b>Q${i+1}:</b> Song Name</p>
          <input type="text" name="song_${i}" maxlength="250">
          <p><b>Requested By:</b></p>
          ${q.choices.map((c, j) => `
            <label><input type="radio" name="req_${i}" value="${c}"> ${c}</label>
          `).join("")}
        `;
        form.appendChild(div);
      });

      document.getElementById("submitQuiz").addEventListener("click", function() {
        let score = 0;
        const answers = {};

        questions.forEach((q, i) => {
          const songAns = form[`song_${i}`].value.trim();
          const reqAns = form[`req_${i}`].value;

          answers[`Q${i+1}`] = {song: songAns, requestedBy: reqAns};

          if (songAns.toLowerCase() === q.song.toLowerCase()) score++;
          if (reqAns === q.correct) score++;
        });

        const submissions = JSON.parse(localStorage.getItem("submissions") || "{}");
        submissions[userEmail] = {
          email: userEmail,
          score: score,
          answers: answers,
          timestamp: new Date().toISOString()
        };
        localStorage.setItem("submissions", JSON.stringify(submissions));

        document.getElementById("quizContainer").innerHTML =
          `<h2>Thank you for submitting!</h2><p>Your score: ${score}</p>`;
      });
    }
  </script>
</body>
</html>
