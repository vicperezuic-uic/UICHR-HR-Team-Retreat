<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UIC Song Quiz</title>
<style>
body { font-family: 'Segoe UI', sans-serif; background:#f4f6f9; margin:0; padding:20px; }
img { width:150px; position:absolute; top:20px; left:20px; }
.quiz-container { max-width:900px; margin:0 auto; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.question { margin-bottom:20px; }
input[type=text] { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
label { display:block; margin:4px 0; }
button { background:#d50032; color:white; border:none; padding:12px 20px; border-radius:8px; cursor:pointer; font-size:16px; }
button:hover { background:#a00025; }
</style>
</head>
<body>
<img src="uic_logo.jpg" alt="UIC Logo">
<div class="quiz-container">
  <h1>UIC Song Quiz</h1>
  <form id="quizForm"></form>
  <button id="submitBtn" type="button">Submit Quiz</button>
</div>

<!-- Load questions -->
<script src="questions.js"></script>

<script>
document.getElementById("submitBtn").addEventListener("click", async function(){
  const currentUser = localStorage.getItem("currentUser");
  if (!currentUser) {
    alert("Please start from the Start page.");
    window.location.href = "start.html";
    return;
  }

  const userAnswers = [];
  questions.forEach((q, i) => {
    const songAnswer = document.getElementById(`song-${i}`).value.trim();
    const radios = document.getElementsByName(`requester-${i}`);
    let requesterAnswer = "";
    for (let r of radios) if (r.checked) requesterAnswer = r.value;
    userAnswers.push({ songAnswer, requesterAnswer });
  });

  // Send to Google Apps Script
  const response = await fetch("https://script.google.com/macros/s/AKfycbxialNjj-LDHMo6HU9wOoFCQS2llYUF7C8UfKNthTM2ChnJyVDkH7N9cGFAIxi5mtQL/exec", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email: currentUser, answers: userAnswers })
  });

  const result = await response.json();
  if (result.status === "success") {
    alert(`Quiz submitted! You scored ${result.score} points.`);
    localStorage.removeItem("currentUser");
    window.location.href = "start.html";
  } else {
    alert("Error submitting quiz. Please try again.");
  }
});
</script>
