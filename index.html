<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>UIC Song Quiz</title>
<style>
body { font-family:'Segoe UI', sans-serif; background:#f4f6f9; margin:0; padding:20px; }
img { width:150px; position:absolute; top:20px; left:20px; }
.quiz-container { max-width:900px; margin:0 auto; background:white; padding:20px; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,0.1); }
.question { margin-bottom:20px; }
input[type=text] { width:100%; padding:8px; margin:5px 0; border-radius:6px; border:1px solid #ccc; }
label { display:block; margin:4px 0; }
button { background:#d50032; color:white; border:none; padding:12px 20px; border-radius:8px; cursor:pointer; font-size:16px; }
button:hover { background:#a00025; }
</style>
</head>
<body>
<img src="uic_logo.jpg" alt="UIC Logo">
<div class="quiz-container">
  <h1>UIC Song Quiz</h1>
  <form id="quizForm"></form>
  <button id="submitBtn">Submit Quiz</button>
</div>

<script src="questions.js"></script>
<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbxialNjj-LDHMo6HU9wOoFCQS2llYUF7C8UfKNthTM2ChnJyVDkH7N9cGFAIxi5mtQL/exec";
const currentUser = localStorage.getItem("currentUser");

// Redirect if no email
if(!currentUser){
  alert("Please enter your email first.");
  window.location.href = "start.html";
}

// Populate quiz
window.onload = function() {
  const form = document.getElementById("quizForm");
  questions.forEach((q,i)=>{
    const div = document.createElement("div");
    div.className = "question";
    div.innerHTML = `
      <h3>Q${i+1} - Song Name</h3>
      <input type="text" id="song-${i}" maxlength="250" placeholder="Enter song name">
      <h4>Requested By</h4>
      ${q.choices.map(c => `<label><input type="radio" name="requester-${i}" value="${c}"> ${c}</label>`).join('')}
    `;
    form.appendChild(div);
  });
};

// Submit quiz to Web App
document.getElementById("submitBtn").addEventListener("click", async function(){
  const userAnswers = questions.map((q,i)=>{
    const songAnswer = document.getElementById(`song-${i}`).value.trim();
    const radios = document.getElementsByName(`requester-${i}`);
    let requesterAnswer = "";
    for(let r of radios){ if(r.checked) requesterAnswer=r.value; }
    return { songAnswer, requesterAnswer };
  });

  try {
    const response = await fetch(WEB_APP_URL, {
      method: "POST",
      body: JSON.stringify({ email: currentUser, answers: userAnswers }),
      headers: { "Content-Type": "application/json" }
    });
    const result = await response.json();

    if(result.status === "success"){
      alert(`Submission recorded! Your score: ${result.score}`);
      localStorage.removeItem("currentUser"); // Prevent resubmission
      window.location.href = "start.html";
    } else {
      alert("Error submitting quiz: " + result.message);
    }
  } catch(err){
    alert("Error submitting quiz: " + err.message);
  }
});
</script>
</body>
</html>
